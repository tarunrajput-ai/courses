<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Transformer Demos</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">
  <div id="root"></div>
  <script type="text/babel">
    const { useState } = React;

    // Demo 1: Embedding
    function EmbeddingDemo() {
      const [sel, setSel] = useState(0);
      const tokens = ["I", "love", "AI"];
      const ids = [2, 3, 4];
      const vectors = {2: [0.10, 0.20, 0.30, 0.40], 3: [0.50, 0.10, 0.80, 0.20], 4: [0.90, 0.70, 0.20, 0.10]};
      
      return (
        <div className="p-4 bg-white rounded-lg shadow mb-4">
          <h2 className="text-xl font-bold mb-3 text-purple-700">1. Token Embedding</h2>
          <div className="flex gap-2 mb-3">
            {tokens.map((t, i) => (
              <button key={i} onClick={() => setSel(i)} 
                className={`px-3 py-2 rounded ${sel === i ? 'bg-purple-500 text-white' : 'bg-gray-200'}`}>
                "{t}" â†’ ID:{ids[i]}
              </button>
            ))}
          </div>
          <div className="bg-green-100 p-3 rounded font-mono">
            Vector: [{vectors[ids[sel]].join(', ')}]
          </div>
        </div>
      );
    }

    // Demo 2: Positional Encoding
    function PositionalDemo() {
      const [pos, setPos] = useState(1);
      const d = 8;
      const pe = Array(d).fill(0).map((_, i) => {
        const div = Math.pow(10000, (2*Math.floor(i/2))/d);
        return i%2===0 ? Math.sin(pos/div) : Math.cos(pos/div);
      });
      
      return (
        <div className="p-4 bg-white rounded-lg shadow mb-4">
          <h2 className="text-xl font-bold mb-3 text-orange-700">2. Positional Encoding</h2>
          <div className="mb-3">
            <label>Position: {pos}</label>
            <input type="range" min="0" max="10" value={pos} onChange={e => setPos(+e.target.value)} className="w-full"/>
          </div>
          <div className="flex gap-1 flex-wrap">
            {pe.map((v, i) => (
              <span key={i} className={`px-2 py-1 rounded text-xs font-mono ${i%2===0?'bg-blue-200':'bg-purple-200'}`}>
                {v.toFixed(2)}
              </span>
            ))}
          </div>
        </div>
      );
    }

    // Demo 3: Q,K,V
    function QKVDemo() {
      const tokens = ["I", "love", "AI"];
      const Q = [[1.10, 0.82, 1.10, 0.89], [1.18, 0.73, 0.98, 0.85], [1.42, 1.12, 1.23, 1.35]];
      const K = [[1.05, 0.95, 0.78, 1.12], [1.02, 0.68, 0.72, 0.92], [1.38, 1.28, 1.05, 1.42]];
      const V = [[0.98, 0.88, 1.02, 0.75], [0.85, 0.72, 0.95, 0.68], [1.25, 1.15, 1.32, 1.08]];
      const fmt = arr => `[${arr.map(n=>n.toFixed(2)).join(', ')}]`;
      
      return (
        <div className="p-4 bg-white rounded-lg shadow mb-4">
          <h2 className="text-xl font-bold mb-3 text-blue-700">3. Q, K, V Projections</h2>
          <div className="grid grid-cols-3 gap-2 text-xs">
            <div className="bg-blue-100 p-2 rounded">
              <p className="font-bold">Query</p>
              {Q.map((r,i) => <p key={i} className="font-mono">{tokens[i]}: {fmt(r)}</p>)}
            </div>
            <div className="bg-green-100 p-2 rounded">
              <p className="font-bold">Key</p>
              {K.map((r,i) => <p key={i} className="font-mono">{tokens[i]}: {fmt(r)}</p>)}
            </div>
            <div className="bg-purple-100 p-2 rounded">
              <p className="font-bold">Value</p>
              {V.map((r,i) => <p key={i} className="font-mono">{tokens[i]}: {fmt(r)}</p>)}
            </div>
          </div>
        </div>
      );
    }

    // Demo 4: Attention
    function AttentionDemo() {
      const [step, setStep] = useState(0);
      const tokens = ["I", "love", "AI"];
      const QKt = [[3.79, 3.21, 4.89], [3.63, 3.12, 4.63], [4.88, 4.14, 6.33]];
      const scaled = QKt.map(r => r.map(v => v/2));
      const softmax = arr => { const e=arr.map(x=>Math.exp(x)); const s=e.reduce((a,b)=>a+b); return e.map(x=>x/s); };
      const weights = scaled.map(r => softmax(r));
      const data = [{t:"QK^T", m:QKt}, {t:"Ã·âˆšd_k", m:scaled}, {t:"Softmax", m:weights}];
      
      return (
        <div className="p-4 bg-white rounded-lg shadow mb-4">
          <h2 className="text-xl font-bold mb-3 text-pink-700">4. Scaled Dot-Product Attention</h2>
          <div className="flex gap-2 mb-3">
            {data.map((d,i) => (
              <button key={i} onClick={() => setStep(i)} 
                className={`px-3 py-1 rounded ${step===i?'bg-pink-500 text-white':'bg-gray-200'}`}>{d.t}</button>
            ))}
          </div>
          <table className="text-sm font-mono w-full">
            <thead><tr className="bg-gray-200"><th></th>{tokens.map(t=><th key={t} className="p-1">K:{t}</th>)}</tr></thead>
            <tbody>
              {data[step].m.map((row, i) => (
                <tr key={i}>
                  <td className="p-1 font-bold">Q:{tokens[i]}</td>
                  {row.map((v, j) => (
                    <td key={j} className={`p-1 text-center ${step===2&&v>0.35?'bg-yellow-200 font-bold':''}`}>{v.toFixed(2)}</td>
                  ))}
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      );
    }

    // Demo 5: Multi-Head
    function MultiHeadDemo() {
      const [h, setH] = useState(0);
      const tokens = ["I", "love", "AI"];
      const heads = [
        {n:"Head 1", a:[[0.45,0.30,0.25],[0.35,0.40,0.25],[0.30,0.25,0.45]]},
        {n:"Head 2", a:[[0.20,0.50,0.30],[0.25,0.25,0.50],[0.40,0.35,0.25]]}
      ];
      
      return (
        <div className="p-4 bg-white rounded-lg shadow mb-4">
          <h2 className="text-xl font-bold mb-3 text-indigo-700">5. Multi-Head Attention</h2>
          <div className="flex gap-2 mb-3">
            {heads.map((hd,i) => (
              <button key={i} onClick={() => setH(i)} 
                className={`px-3 py-1 rounded ${h===i?'bg-indigo-500 text-white':'bg-gray-200'}`}>{hd.n}</button>
            ))}
          </div>
          <table className="text-sm font-mono w-full">
            <thead><tr className="bg-gray-200"><th></th>{tokens.map(t=><th key={t} className="p-1">{t}</th>)}</tr></thead>
            <tbody>
              {heads[h].a.map((row, i) => (
                <tr key={i}>
                  <td className="p-1 font-bold">{tokens[i]}</td>
                  {row.map((v, j) => (
                    <td key={j} className={`p-1 text-center ${v>=0.4?'bg-yellow-300 font-bold':''}`}>{v.toFixed(2)}</td>
                  ))}
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      );
    }

    // Demo 6: Flow
    function FlowDemo() {
      const steps = ["Input â†’ Tokenize", "Embedding Lookup", "+ Positional Encoding", "Multi-Head Attention", 
                     "Add & LayerNorm", "Feed-Forward", "Add & LayerNorm", "Output â†’ Softmax"];
      return (
        <div className="p-4 bg-white rounded-lg shadow mb-4">
          <h2 className="text-xl font-bold mb-3 text-gray-700">6. Transformer Flow</h2>
          <div className="flex flex-col gap-1">
            {steps.map((s, i) => (
              <div key={i} className="flex items-center gap-2">
                <div className="bg-gradient-to-r from-blue-100 to-purple-100 p-2 rounded flex-1">{i+1}. {s}</div>
                {i < steps.length-1 && <span>â†“</span>}
              </div>
            ))}
          </div>
        </div>
      );
    }

    // Main App
    function App() {
      return (
        <div className="max-w-3xl mx-auto p-4">
          <h1 className="text-2xl font-bold text-center mb-4">ðŸ¤– Transformer: Attention Is All You Need</h1>
          <EmbeddingDemo />
          <PositionalDemo />
          <QKVDemo />
          <AttentionDemo />
          <MultiHeadDemo />
          <FlowDemo />
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
